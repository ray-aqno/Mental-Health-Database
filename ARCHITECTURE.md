# System Architecture & Data Flow

## System Architecture Diagram

```
???????????????????????????????????????????????????????????????????
?                        WEB BROWSER                              ?
?  ??????????????????????????????????????????????????????????   ?
?  ?    Interactive Leaflet.js Map with College Pins        ?   ?
?  ?  - Shows college locations                             ?   ?
?  ?  - Click pins for resource details                     ?   ?
?  ?  - Contact information accessible                      ?   ?
?  ??????????????????????????????????????????????????????????   ?
???????????????????????????????????????????????????????????????????
                       ? HTTP Request (fetch API)
                       ?
???????????????????????????????????????????????????????????????????
?                 ASP.NET CORE APPLICATION                        ?
?  ?????????????????????????????????????????????????????????     ?
?  ?              REST API Endpoints                       ?     ?
?  ?  GET  /api/colleges           ? fetch on page load   ?     ?
?  ?  GET  /api/colleges/{id}                             ?     ?
?  ?  POST /api/colleges           ? import script        ?     ?
?  ?  POST /api/resources          ? import script        ?     ?
?  ?????????????????????????????????????????????????????????     ?
?                       ?                                         ?
?  ????????????????????????????????????????????????????????     ?
?  ?         Controllers (Handle Requests)                ?     ?
?  ?  - CollegesController                               ?     ?
?  ?  - ResourcesController                              ?     ?
?  ????????????????????????????????????????????????????????     ?
?                       ?                                         ?
?  ????????????????????????????????????????????????????????     ?
?  ?      Service Layer (IDataService)                    ?     ?
?  ?  - GetAllCollegesWithResourcesAsync()               ?     ?
?  ?  - GetResourcesByCollegeIdAsync()                   ?     ?
?  ?  - AddCollegeAsync(), UpdateAsync()                 ?     ?
?  ????????????????????????????????????????????????????????     ?
?                       ?                                         ?
?  ????????????????????????????????????????????????????????     ?
?  ?    Entity Framework Core (ORM)                       ?     ?
?  ?  - DatabaseContext                                  ?     ?
?  ?  - DbSet<College>                                  ?     ?
?  ?  - DbSet<MentalHealthResource>                     ?     ?
?  ????????????????????????????????????????????????????????     ?
????????????????????????????????????????????????????????????????????
                        ? SQL Queries
                        ?
???????????????????????????????????????????????????????????????????
?                    SQL DATABASE                                 ?
?  ??????????????????????????????????????????????????????        ?
?  ?  Colleges Table                                    ?        ?
?  ?  ?? Id (Primary Key)                             ?        ?
?  ?  ?? Name                                         ?        ?
?  ?  ?? Location                                     ?        ?
?  ?  ?? Latitude                                     ?        ?
?  ?  ?? Longitude                                    ?        ?
?  ?  ?? Website                                      ?        ?
?  ?  ?? CreatedAt                                    ?        ?
?  ?  ?? UpdatedAt                                    ?        ?
?  ??????????????????????????????????????????????????????        ?
?                                                                 ?
?  ??????????????????????????????????????????????????????        ?
?  ?  MentalHealthResources Table                       ?        ?
?  ?  ?? Id (Primary Key)                             ?        ?
?  ?  ?? CollegeId (Foreign Key) ???????             ?        ?
?  ?  ?? ServiceName                   ?             ?        ?
?  ?  ?? Description                   ?             ?        ?
?  ?  ?? ContactEmail                  ?             ?        ?
?  ?  ?? ContactPhone                  ?             ?        ?
?  ?  ?? ContactWebsite               ?             ?        ?
?  ?  ?? Department                    ?             ?        ?
?  ?  ?? OfficeHours                  ?             ?        ?
?  ?  ?? Location                      ?             ?        ?
?  ?  ?? FreshmanNotes                ?             ?        ?
?  ?  ?? CreatedAt                    ?             ?        ?
?  ?  ?? UpdatedAt                    ?             ?        ?
?  ?????????????????????????????????????????????????????        ?
?                                        ?                       ?
?  (Relationship: 1 College ? Many Resources)                   ?
???????????????????????????????????????????????????????????????????
```

## Data Import Flow

```
????????????????????????????????????????
?     Data Sources                     ?
?  ?? Web Scraper (Python)             ?
?  ?? Manual JSON Entry                ?
?  ?? CSV/Spreadsheet                 ?
????????????????????????????????????????
                 ?
                 ?
????????????????????????????????????????
?  Sample JSON Format                  ?
?  (sample_colleges_data.json)         ?
?  {                                   ?
?    "colleges": [                     ?
?      {                               ?
?        "name": "...",               ?
?        "location": "...",           ?
?        "latitude": 40.1164,         ?
?        "longitude": -88.2434,       ?
?        "resources": [...]           ?
?      }                               ?
?    ]                                ?
?  }                                   ?
????????????????????????????????????????
                 ?
                 ?
????????????????????????????????????????
?  Python Data Importer                ?
?  (data_importer.py)                  ?
?                                      ?
?  1. Load JSON file                   ?
?  2. Parse college data               ?
?  3. POST to /api/colleges            ?
?  4. For each college:                ?
?     - POST resources to /api/resources?
?  5. Log results                      ?
????????????????????????????????????????
                 ?
                 ?
????????????????????????????????????????
?  ASP.NET Core API                    ?
?                                      ?
?  POST /api/colleges                  ?
?  ?? Create College record            ?
?  ?? Return College ID                ?
?  ?? 201 Created                      ?
?                                      ?
?  POST /api/resources                 ?
?  ?? Link to College ID               ?
?  ?? Create Resource record           ?
?  ?? 201 Created                      ?
????????????????????????????????????????
                 ?
                 ?
????????????????????????????????????????
?  Database Storage                    ?
?                                      ?
?  ? College record created            ?
?  ? Resource records created          ?
?  ? Relationships established         ?
?  ? Timestamps recorded               ?
????????????????????????????????????????
```

## Request-Response Cycle

### Scenario 1: User Views Map

```
USER BROWSER
     ?
     ?? Page loads
     ?
     ?? JavaScript executes
     ?    ?? fetch('/api/colleges')
     ?
     ?
ASP.NET CORE API
     ?
     ?? GET /api/colleges
     ?    ?? CollegesController.GetAllColleges()
     ?
     ?
DATA SERVICE
     ?
     ?? GetAllCollegesWithResourcesAsync()
     ?    ?? _context.Colleges.Include(c => c.Resources)
     ?
     ?
ENTITY FRAMEWORK
     ?
     ?? Generate SQL query
     ?    ?? SELECT * FROM Colleges JOIN Resources...
     ?
     ?
SQL DATABASE
     ?
     ?? Execute query
     ?    ?? Return all colleges with resources
     ?
     ?
APPLICATION (Entity Framework)
     ?
     ?? Deserialize to C# objects
     ?    ?? List<College> with nested Resources
     ?
     ?
API CONTROLLER
     ?
     ?? Serialize to JSON
     ?    ?? [{ "id": 1, "name": "...", "resources": [...] }]
     ?
     ?
HTTP RESPONSE
     ?
     ?? Status: 200 OK
     ? Content-Type: application/json
     ? Body: JSON array of colleges
     ?
     ?
JAVASCRIPT (Browser)
     ?
     ?? Parse JSON
     ?? Call addMarkersToMap(colleges)
     ?? For each college:
     ?  ?? L.marker([lat, lng])
     ?  ?? bindPopup(createPopupContent())
     ?  ?? addTo(map)
     ?
     ?
LEAFLET.JS MAP
     ?
     ?? Render map tiles
     ?? Add markers
     ?? Fit bounds to colleges
     ?
     ?
USER SEES MAP
```

### Scenario 2: User Clicks College Pin

```
USER CLICKS MARKER
     ?
     ?
LEAFLET.JS
     ?
     ?? Trigger popup event
     ?
     ?
JAVASCRIPT
     ?
     ?? createPopupContent(college)
     ?    ?? Build HTML with college name
     ?    ?? Add location and website
     ?    ?? Loop through resources:
     ?    ?   ?? Service name
     ?    ?   ?? Description
     ?    ?   ?? Contact info (email, phone)
     ?    ?   ?? Office hours
     ?    ?   ?? Freshman notes
     ?    ?? Return DOM element
     ?
     ?
LEAFLET POPUP
     ?
     ?? Display formatted content
     ?? Handle link clicks
     ?    ?? Email: mailto: links
     ?    ?? Phone: tel: links
     ?    ?? Website: https:// links
     ?
     ?
USER INTERACTS
     ?
     ?? Click email ? open mail client
     ?? Click phone ? dial (mobile) or copy (desktop)
     ?? Click website ? open in new tab
```

### Scenario 3: Data Import

```
PYTHON SCRIPT (data_importer.py)
     ?
     ?? Load JSON file
     ?    ?? parse as Python dict
     ?
     ?? Iterate colleges
     ?
     ? (For each college)
requests.post('/api/colleges', json=college_data)
     ?
     ?
ASP.NET CORE API
     ?
     ?? POST /api/colleges
     ?    ?? CollegesController.CreateCollege(college)
     ?
     ?
DATA SERVICE
     ?
     ?? AddCollegeAsync(college)
     ?    ?? _context.Colleges.Add(college)
     ?    ?? _context.SaveChangesAsync()
     ?
     ?
ENTITY FRAMEWORK
     ?
     ?? Track college entity
     ?? Generate INSERT SQL
     ?
     ?
SQL DATABASE
     ?
     ?? Execute INSERT
     ?? Return new identity
     ?
     ?
APPLICATION
     ?
     ?? Receive College ID
     ?
     ?
HTTP RESPONSE
     ?
     ?? Status: 201 Created
     ?? Body: { "id": 1, "name": "..." }
     ?
     ?
PYTHON SCRIPT
     ?
     ?? Get College ID
     ?
     ?? For each resource in college:
     ?
     ? (For each resource)
requests.post('/api/resources', json={
    'collegeId': college_id,
    'serviceName': resource['service_name'],
    ...
})
     ?
     ?
ASP.NET CORE API
     ?
     ?? POST /api/resources
     ?    ?? ResourcesController.CreateResource(resource)
     ?
     ?
(Similar flow to college creation)
     ?
     ?
HTTP RESPONSE
     ?
     ?? Status: 201 Created
     ?
     ?
PYTHON SCRIPT
     ?
     ?? Print success message
     ?? Move to next college
     ?
     ?
PROCESS COMPLETE
     ?
     ?? Database populated with all colleges & resources
```

## Deployment Architecture

```
???????????????????????????????????????????
?         User's Browser                  ?
?  (Desktop, Mobile, Tablet)              ?
???????????????????????????????????????????
             ? HTTPS
             ?
???????????????????????????????????????????
?    Azure CDN (Optional)                 ?
?  - Caches static assets                 ?
?  - CSS, JavaScript files                ?
???????????????????????????????????????????
             ?
             ?
???????????????????????????????????????????
?    Azure App Service                    ?
?  ????????????????????????????????????????
?  ?  ASP.NET Core Application           ??
?  ?  - Controllers                      ??
?  ?  - Services                         ??
?  ?  - Views                            ??
?  ????????????????????????????????????????
???????????????????????????????????????????
             ? Connection String
             ?
???????????????????????????????????????????
?    Azure SQL Database                   ?
?  - Colleges table                       ?
?  - Resources table                      ?
?  - Backups & redundancy                 ?
?  - Scalable storage                     ?
???????????????????????????????????????????
```

## Technology Stack Layers

```
??????????????????????????????????????????????
?  PRESENTATION LAYER                        ?
?  ?? HTML (Razor Views)                    ?
?  ?? CSS (Bootstrap + Custom)              ?
?  ?? JavaScript (Vanilla JS + Leaflet.js)  ?
??????????????????????????????????????????????
?  APPLICATION LAYER                         ?
?  ?? ASP.NET Core MVC                      ?
?  ?? Controllers (REST API)                ?
?  ?? Dependency Injection                  ?
??????????????????????????????????????????????
?  BUSINESS LOGIC LAYER                      ?
?  ?? DataService (IDataService)            ?
??????????????????????????????????????????????
?  DATA ACCESS LAYER                         ?
?  ?? Entity Framework Core                 ?
?  ?? DbContext                             ?
?  ?? LINQ Queries                          ?
??????????????????????????????????????????????
?  DATABASE LAYER                            ?
?  ?? SQL Server                            ?
?     ?? Colleges Table                     ?
?     ?? Resources Table                    ?
??????????????????????????????????????????????
?  DATA COLLECTION LAYER (Offline)          ?
?  ?? Python Scrapy                        ?
?  ?? JSON Files                           ?
?  ?? Data Importer Script                 ?
??????????????????????????????????????????????
```

---

This architecture provides:
- **Scalability**: Easy to add more colleges
- **Maintainability**: Clear separation of concerns
- **Performance**: Efficient database queries with relationships
- **Security**: Input validation, proper error handling
- **Flexibility**: Customizable map, easy data updates
- **Reliability**: Database transactions, cascade operations
